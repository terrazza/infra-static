
    ###############################################################
    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    location ~ "^/api/(?<NAMESPACE>\w+)/(?<SERVICE>\w+)/(.*)$" {
        root /var/www/html/src;
# a resovler definition is needed!
# because we use Docker, we have to use the internal Docker DNS resolver IP which is 127.0.0.11.
# (notice)the internal AWS DNS resolver IP is your AWS VPC network range plus two.
# To further remove the downtime, reduce the resolve cache time to 10 seconds instead of the default 5 minutes.
        resolver 127.0.0.11 valid=10s;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root/index.php;
        fastcgi_pass ${NAMESPACE}_${SERVICE}:9000;
        error_page 502 =403 /;
    }
