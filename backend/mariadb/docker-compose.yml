version: "3.4"

services:
  mysql:
    image: db-prod:1.0.1
    container_name: ${NAMESPACE}_${SERVICE_NAME}
    environment:
      MARIADB_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
    restart: on-failure
    command: --character-set-server=utf8 --collation-server=utf8_general_ci
    ports:
      - "3306:${SERVICE_EXPOSE_PORT}"
#      - ./data:/var/lib/mysql
    healthcheck:
      test: "mysql -h127.0.0.1 -P$$DB_PORT -uroot -p$$MARIADB_ROOT_PASSWORD -e 'SHOW DATABASES;'"
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 30s
